package client.main.command.impl.feature;

import client.main.Client;
import client.main.command.Parameters;
import net.minecraft.client.Minecraft;
import net.minecraft.util.text.StringTextComponent;
import net.minecraft.util.text.event.HoverEvent;
import net.minecraft.util.text.Style;
import net.minecraft.util.StringUtils;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;
import java.util.Arrays;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class IrcKuCommand extends IRCCommand {

    private static final String CHAT_PREFIX = "§8[§9IRC§8]§r ";
    private static final long COOLDOWN_MS = 3000;
    private static long lastMessageTime = 0;
    private static int totalMessagesSent = 0;

    private static final List<IRCMessage> globalHistory = Collections.synchronizedList(new ArrayList<>());
    private static final int MAX_GLOBAL_HISTORY = 100;

    @Override
    public String name() { return "irc"; }

    @Override
    public String description() { return "Глобальный IRC чат (Minecraft + Web)"; }

    @Override
    public List<String> adviceMessage() {
        return Arrays.asList(
            "§7• §f.irc <текст> §7— отправить в глобальный чат",
            "§7• §f.irc help §7— справка",
            "§7• §fПоддержка веб-чата",
            "§7• §fКулдаун: 3 сек"
        );
    }

    @Override
    public void execute(Parameters parameters) {
        Minecraft mc = Minecraft.getInstance();
        if (mc.player == null) return;

        String fullMessage = parameters.collectMessage(0);
        if (fullMessage == null || fullMessage.trim().isEmpty()) {
            showHelp();
            return;
        }

        String trimmed = fullMessage.trim();

        long now = System.currentTimeMillis();
        if (now - lastMessageTime < COOLDOWN_MS && lastMessageTime > 0) {
            long rem = COOLDOWN_MS - (now - lastMessageTime);
            mc.player.sendMessage(new StringTextComponent(String.format("§c[IRC] Подожди §e%d.%03d §cсек", rem / 1000, rem % 1000)), mc.player.getUniqueID());
            return;
        }

        String[] parts = trimmed.split(" ", 2);
        String cmd = parts[0].toLowerCase();

        switch (cmd) {
            case "help": showHelp(); return;
            case "history": case "h": showHistory(); return;
            case "clear": case "c": clearHistory(); return;
            case "stats": showStats(); return;
            case "test": sendTestMessage(); return;
            case "color": case "colors": showColors(); return;
            case "time": showTime(); return;
           
